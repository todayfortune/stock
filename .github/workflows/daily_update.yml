name: ìœ¼ì™• ë ˆì´ë” ìë™ ë¶„ì„

on:
  schedule:
    - cron: '10 0 * * 1-5'
    - cron: '0 1 * * 1-5'
    - cron: '0 3 * * 1-5'
    - cron: '30 6 * * 1-5'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ì €ì¥ì†Œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      uses: actions/checkout@v3

    - name: íŒŒì´ì¬ ì„¤ì • (3.11)
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      run: |
        pip install pandas numpy finance-datareader yfinance telethon

    # 1. ê¸°ë³¸ ë¶„ì„
    - name: ìœ¼ì™• ë ˆì´ë” ê°€ë™ (Standard)
      run: |
        python scripts/fetch_krx.py

    # 2. ì›”ê°€ ì „ëµ
    - name: ì›”ê°€ ì „ëµ ë°±í…ŒìŠ¤íŒ…
      run: |
        python scripts/fetch_wallstreet.py

    # 3. SDI ì „ëµ
    - name: SDI ì „ëµ ë°±í…ŒìŠ¤íŒ…
      run: |
        python scripts/fetch_sdi.py

    # 4. [NEW] í€€íŠ¸ ë¶„ì„ (ëˆ„ë½ë˜ì—ˆë˜ ë¶€ë¶„)
    - name: í€€íŠ¸ ë¶„ì„ ì‹¤í–‰
      run: |
        python scripts/fetch_quant.py

    # 5. í…”ë ˆê·¸ë¨ ë‰´ìŠ¤
    - name: í…”ë ˆê·¸ë¨ ë‰´ìŠ¤ ìˆ˜ì§‘
      env:
        TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
        TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
        TELEGRAM_SESSION: ${{ secrets.TELEGRAM_SESSION }}
      run: |
        python scripts/fetch_telegram.py

    - name: ê²°ê³¼ ì €ì¥
      run: |
        git config --global user.name "Ki-hyun Bot"
        git config --global user.email "bot@todayfortune.com"
        git add data/
        git commit -m "ğŸ“ˆ ìœ¼ì™• ë ˆì´ë” ì „ì²´ ì—…ë°ì´íŠ¸" || echo "ë³€ê²½ ì‚¬í•­ ì—†ìŒ"
        git push
