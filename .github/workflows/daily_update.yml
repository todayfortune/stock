name: ìœ¼ì™• ë ˆì´ë” ìë™ ë¶„ì„

on:
  # 1. ìŠ¤ì¼€ì¤„ë§ (UTC ê¸°ì¤€, ì›”~ê¸ˆ ì‹¤í–‰)
  schedule:
    - cron: '10 0 * * 1-5'  # 09:10 (ì¥ì‹œì‘ ì§í›„)
    - cron: '0 1 * * 1-5'   # 10:00 (ì˜¤ì „ì¥)
    - cron: '0 3 * * 1-5'   # 12:00 (ì ì‹¬)
    - cron: '40 6 * * 1-5'  # 15:30 (ì¥ë§ˆê°)
  
  # 2. ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ì €ì¥ì†Œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      uses: actions/checkout@v3

    # [FIX] íŒŒì´ì¬ ë²„ì „ì„ 3.9 -> 3.11ë¡œ ì—…ê·¸ë ˆì´ë“œ (yfinance ì—ëŸ¬ í•´ê²°)
    - name: íŒŒì´ì¬ ì„¤ì • (3.11 ë²„ì „)
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      run: |
        pip install pandas numpy finance-datareader yfinance

    - name: ìœ¼ì™• ë ˆì´ë” ê°€ë™ (ë°ì´í„° ìˆ˜ì§‘ & ë¶„ì„)
      run: |
        python scripts/fetch_krx.py

    - name: ê²°ê³¼ ì €ì¥ (Commit & Push)
      run: |
        git config --global user.name "Ki-hyun Bot"
        git config --global user.email "bot@todayfortune.com"
        git add data/
        git commit -m "ğŸ“ˆ ìœ¼ì™• ë ˆì´ë” ë°ì´í„° ì—…ë°ì´íŠ¸ (Python 3.11)" || echo "ë³€ê²½ ì‚¬í•­ ì—†ìŒ"
        git push
